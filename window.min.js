function Window(a,b){'use strict';function c(a){WindowUtil.getProperty(b,"resizable",!0)&&(J=!0,w.classList.add("window_resizing"),G=a.target.getAttribute("data-resize"),document.body.style.cursor=H[G],F.x=a.clientX,F.y=a.clientY,w.classList.add("window_no_animation"),document.addEventListener("mouseup",d),document.addEventListener("mousemove",f),document.body.classList.add("text_not_selectable"),v.on("resize_start")(a))}function d(a){a&&a.preventDefault(),0>=b.position.y&&v.maximize(),document.body.style.cursor="",w.classList.remove("window_no_animation"),w.classList.remove("window_resizing"),J=!1,document.removeEventListener("mouseup",d),document.removeEventListener("mousemove",f),document.body.classList.remove("text_not_selectable"),v.on("resize_stop")(a)}function f(a){if(a.preventDefault(),!1==J)return void d();var c=0,e=0,f=WindowUtil.getProperty(b,"min_size",{width:200,height:150}),g=WindowUtil.getProperty(b,"max_size","");("nw"==G||"n"==G||"ne"==G)&&(C.height>f.height||a.clientY<b.position.y)&&(e=-(F.y-a.clientY),f.height<=C.height-e&&(""==g||g.height>=C.height-e)&&(b.position.y+=e)),("ne"==G||"e"==G||"se"==G)&&(C.width>f.width||a.clientX>b.position.x+C.width)&&(c=F.x-a.clientX),("sw"==G||"s"==G||"se"==G)&&(C.height>f.height||a.clientY>b.position.y+C.height)&&(e=F.y-a.clientY),("nw"==G||"w"==G||"sw"==G)&&(C.width>f.width||a.clientX<b.position.x)&&(c=-(F.x-a.clientX),f.width<=C.width-c&&(""==g||g.width>=C.width-c)&&(b.position.x+=c)),("nw"==G||"n"==G||"ne"==G||"w"==G||"sw"==G)&&n(),F.x=a.clientX,F.y=a.clientY,v.changeOption("size",{width:C.width-c,height:C.height-e}),l(),v.on("resize")(a)}function g(a){if(!J){if(!v.isNormalSized()){w.classList.add("window_no_animation"),v.normalSize();var b=w.getElementsByClassName("window_bar")[0];v.changeOption("position",{x:a.clientX-b.offsetWidth/2,y:a.clientY-b.offsetHeight/2}),w.classList.remove("window_no_animation")}if(a.preventDefault(),!1==I)return void h();var c=E.x-a.clientX,d=E.y-a.clientY;E.x=a.clientX,E.y=a.clientY,v.changeOption("position",{x:w.offsetLeft-c,y:w.offsetTop-d}),n(),v.on("move")(a)}}function h(a){a&&a.preventDefault(),w.classList.remove("window_moving"),0>=b.position.y&&v.maximize(),document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",h),v.on("move_stop")(a)}function j(a){w.classList.remove("window_maximized");var c=w.getElementsByClassName("window_button_toggle_maximize")[0];switch(a){case WindowState.MAXIMIZED:{w.classList.add("window_maximized"),c.innerHTML=WindowUtil.getProperty(b,"normalsize_icon","&#10697;");break}case WindowState.NORMAL:{c.innerHTML=WindowUtil.getProperty(b,"maximize_icon","&#9744;");break}default:c.innerHTML=WindowUtil.getProperty(b,"maximize_icon","&#9744;"),console.warn("This state is not allowed ("+a+"); skipping");}}function k(a){switch(w.classList.remove("window_hidden"),w.classList.remove("window_minimized"),a){case WindowState.HIDDEN:{w.classList.add("window_hidden");break}case WindowState.MINIMIZED:{w.classList.add("window_minimized");break}case WindowState.SHOWN:break;default:console.warn("This window-state is not allowed ("+a+"); skipping");}}function l(){if(y){var a=WindowUtil.getProperty(b,"size","");""==a&&(b.size={width:200,height:150},a=b.size);var c={width:b.size.width,height:b.size.height};C.width=WindowUtil.getProperty(a,"width",200),C.height=WindowUtil.getProperty(a,"height",150);var d=WindowUtil.getProperty(b,"min_size",{width:200,height:150}),e=WindowUtil.getProperty(b,"max_size","");if(""!=d){var f=WindowUtil.getProperty(d,"width",""),g=WindowUtil.getProperty(d,"height","");""!=f&&C.width<f&&(C.width=f,b.size.width=C.width),""!=g&&C.height<g&&(C.height=g,b.size.height=C.height)}if(""!=e){var h=WindowUtil.getProperty(e,"width",""),i=WindowUtil.getProperty(e,"height","");""!=h&&C.width>h&&(C.width=h,b.size.width=C.width),""!=i&&C.height>i&&(C.height=i,b.size.height=C.height)}var j=w.parentElement;C.height>j.offsetHeight&&(C.height=j.offsetHeight,b.size.height=C.height,b.position.y=0),C.width>j.offsetWidth&&(C.width=j.offsetWidth,b.size.width=C.width,b.position.x=0),w.style.width=C.width+"px",w.style.height=C.height+"px",n(),v.on("update_size")({old_size:c,new_size:C})}}function m(){if(y){v.on("update_selected")();var a=WindowUtil.getProperty(b,"selected",!1);a?(w.classList.add("window_selected"),v.on("select")()):(w.classList.remove("window_selected"),v.on("deselect")())}}function n(){if(y){var a=w.parentElement,c=WindowUtil.getProperty(b,"position","");""==c&&(b.position={x:a.offsetWidth/2-w.offsetWidth/2,y:a.offsetHeight/2-w.offsetHeight/2},c=b.position);var d={x:b.position.x,y:b.position.y};D.x=WindowUtil.getProperty(c,"x",0),D.y=WindowUtil.getProperty(c,"y",0),0>D.x&&(D.x=0),0>D.y&&(D.y=0),D.x>a.offsetWidth-w.offsetWidth&&(D.x=a.offsetWidth-w.offsetWidth,b.position.x=D.x),D.y>a.offsetHeight-w.offsetHeight&&(D.y=a.offsetHeight-w.offsetHeight,b.position.y=D.y),w.style.left=D.x+"px",w.style.top=D.y+"px",v.on("update_position")({old_position:d,new_position:D})}}function o(){for(var a=WindowUtil.getProperty(b,"events",{}),c=Object.keys(a),d=0;d<c.length;d++)z[c[d]]=a[c[d]]}function p(){y&&(WindowUtil.getProperty(b,"bar_visible",!0)?w.classList.remove("window_bar_hidden"):w.classList.add("window_bar_hidden"))}function q(){WindowUtil.getProperty(b,"resizable",!0)?w.classList.remove("window_not_resizable"):w.classList.add("window_not_resizable")}function r(){WindowUtil.getProperty(b,"movable",!0)?w.classList.remove("window_not_movable"):w.classList.add("window_not_movable")}function s(){WindowUtil.getProperty(b,"maximizable",!0)?w.classList.remove("window_not_maximizable"):w.classList.add("window_not_maximizable")}function t(){WindowUtil.getProperty(b,"minimizable",!0)?w.classList.remove("window_not_minimizable"):w.classList.add("window_not_minimizable")}function u(){WindowUtil.getProperty(b,"always_on_top",!1)?w.classList.add("window_alway_on_top"):w.classList.remove("window_alway_on_top")}var v=this,w=null,x=Window.count++,y=!0,z={},A=WindowState.HIDDEN,B=WindowState.NORMAL,C={width:0,height:0},D={x:0,y:0},E={x:0,y:0},F={x:0,y:0},G=null,H={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize",nw:"nwse-resize"},I=!1,J=!1;if(this.content=null,"string"!=typeof a)throw new Error("Parameter 1 must be of type string");if("undefined"!=typeof b){if("object"!=typeof b)throw new Error("Parameter 2 must be of type object");if(B=WindowUtil.getProperty(b,"state",WindowState.NORMAL),B!=WindowState.NORMAL&&B!=WindowState.MAXIMIZED)throw new Error("'state' must be WindowState.NORMAL or WindowState.MAXIMIZED")}else b={};"object"!=typeof b.position&&(b.position={x:0,y:0}),"object"!=typeof b.position.x&&(b.position.x=0),"object"!=typeof b.position.y&&(b.position.y=0),this.getTitle=function(){return y?a:void 0},this.setTitle=function(b){if(y){if("string"!=typeof b)throw new Error("Parameter 1 must be of type string");v.on("change_title")({old_title:a,new_title:b}),a=b,null!==typeof w&&(w.getElementsByClassName("window_title")[0].innerHTML=a)}},this.getContainer=function(){if(y)return null==w&&console.warn("Container not yet created"),w},this.changeOption=function(a,c){if(y)if("string"!=typeof a)throw new Error("Parameter 1 must be of type string");else if("undefined"==typeof c)throw new Error("Parameter 2 must be set");else if(b[a]=c,null!=w)switch(a){case"icon":{w.getElementsByClassName("window_icon")[0].innerHTML=c;break}case"minimize_icon":{w.getElementsByClassName("window_button_minimize")[0].innerHTML=c;break}case"maximize_icon":{j(B);break}case"normalsize_icon":{j(B);break}case"close_icon":{w.getElementsByClassName("window_button_close")[0].innerHTML=c;break}case"size":{l();break}case"position":{n();break}case"selected":{m();break}case"min_size":{l();break}case"max_size":{l();break}case"events":{o();break}case"bar_visible":{p();break}case"resizable":{q();break}case"movable":{r();break}case"maximizable":{s();break}case"minimizable":{t();break}case"always_on_top":{u();break}default:this.reload();}},this.getOptions=function(){return y?b:void 0},this.reload=function(){if(y=!0,WindowUtil.getProperty(b,"container",null)!==w&&null!=w&&(w.remove(),w=null),null==w){var d=WindowUtil.getProperty(b,"container",document.body);w=document.createElement("div"),w.className="window",w.id="window_"+x,w.window=v,d.appendChild(w)}l(),n(),m(),o(),p(),q(),r(),s(),t(),u(),A=WindowUtil.getProperty(b,"window_state",WindowState.SHOWN),k(A),w.innerHTML="";var f=document.createElement("div");f.className="window_bar";var z=document.createElement("span");z.className="window_icon",z.innerHTML=WindowUtil.getProperty(b,"icon","");var C=document.createElement("span");C.className="window_title",C.innerHTML=a;var D=document.createElement("div");D.className="window_toggle_buttons";var F=document.createElement("span");F.className="window_button_minimize",F.innerHTML=WindowUtil.getProperty(b,"minimize_icon","_");var G=document.createElement("span");G.className="window_button_toggle_maximize";var J=document.createElement("span");J.className="window_button_close",J.innerHTML=WindowUtil.getProperty(b,"close_icon","&#9587;"),D.appendChild(F),D.appendChild(G),D.appendChild(J),f.appendChild(z),f.appendChild(C),f.appendChild(D),w.appendChild(f);for(var K,L=[],M=["n","ne","e","se","s","sw","w","nw"],N=0;8>N;N++)K=document.createElement("div"),K.className="window_resize_handle window_resize_handle_"+M[N],K.setAttribute("data-resize",M[N]),K.addEventListener("mousedown",c),K.style.cursor=H[M[N]],L.push(K),w.appendChild(K);j(B),null==this.content&&(this.content=document.createElement("div"),this.content.className="window_content"),w.appendChild(this.content);var O=0;f.addEventListener("mousedown",function(a){if(0==a.button){if(I=!0,WindowUtil.getProperty(b,"movable",!0)){for(var c=a.target;c!=f;)if(c!=F&&c!=G&&c!=J)c=c.parentElement;else return;a.preventDefault(),E.x=a.clientX,E.y=a.clientY,w.classList.add("window_moving"),document.addEventListener("mousemove",g),document.addEventListener("mouseup",h)}O++,1==O&&setTimeout(function(){1==O?v.on("move_start")(a):v.toggleMaximize(),O=0},Window.DOUBLE_CLICK_DELAY)}}),f.addEventListener("mouseup",function(a){0!=a.button||(I=!1)}),F.addEventListener("click",function(a){a.preventDefault(),v.minimize()}),G.addEventListener("click",function(a){a.preventDefault(),v.toggleMaximize()}),J.addEventListener("click",function(a){a.preventDefault(),v.close()}),o(),v.on("reload")()},this.changeState=function(a){if(y){if(a!=WindowState.NORMAL&&a!=WindowState.MAXIMIZED)throw new Error("Parameter 1 must be WindowState.NORMAL or WindowState.MAXIMIZED");v.on("change_state")({old_state:B,new_state:a}),B=a,j(a)}},this.changeWindowState=function(a){if(y){if(a!=WindowState.MINIMIZED&&a!=WindowState.HIDDEN&&a!=WindowState.SHOWN)throw new Error("Parameter 1 must be WindowState.HIDDEN or WindowState.MINIMIZED or WindowState.SHOWN");v.on("change_window_state")({old_window_state:A,new_window_state:a}),A=a,k(A)}},this.minimize=function(){y&&WindowUtil.getProperty(b,"minimizable",!0)&&!1!==v.on("minimizing")&&(this.changeWindowState(WindowState.MINIMIZED),v.on("minimize")())},this.normalSize=function(){y&&(this.changeState(WindowState.NORMAL),v.on("normalSize")())},this.maximize=function(){y&&WindowUtil.getProperty(b,"maximizable",!0)&&!1!==v.on("maximizing")&&(this.changeState(WindowState.MAXIMIZED),l(),v.on("maximize")())},this.toggleMaximize=function(){y&&(B==WindowState.NORMAL?v.maximize():v.normalSize())},this.hide=function(){y&&(this.changeWindowState(WindowState.HIDDEN),v.on("hide")())},this.show=function(){y&&(this.changeWindowState(WindowState.SHOWN),v.on("show")())},this.on=function(a,b){return y?"undefined"==typeof b?"function"==typeof z[a]?z[a]:function(){}:void(z[a]=b):void 0},this.removeOn=function(a){y&&delete z[a]},this.getState=function(){return y?B:void 0},this.getWindowState=function(){return y?A:void 0},this.getSize=function(){return y?C:void 0},this.getPosition=function(){return y?D:void 0},this.isMinimized=function(){return y?A==WindowState.MINIMIZED:void 0},this.isHidden=function(){return y?A==WindowState.HIDDEN:void 0},this.isShown=function(){return y?A==WindowState.SHOWN:void 0},this.isVisible=function(){return y?!(this.isMinimized()||this.isHidden()):void 0},this.isMaximized=function(){return y?B==WindowState.MAXIMIZED:void 0},this.isNormalSized=function(){return y?B==WindowState.NORMAL:void 0},this.reset=function(){y&&(this.show(),this.normalSize(),v.on("reset")())},this.close=function(){var a=WindowUtil.getProperty(b,"close_action",Window.DISPOSE_ON_CLOSE);y&&a!=Window.DO_NOTHING_ON_CLOSE&&(!1===v.on("closing")()||(this.hide(),v.on("closed")(),a==Window.DISPOSE_ON_CLOSE&&this.dispose()))},this.dispose=function(){!1!==v.on("disposing")()&&(this.content.remove(),this.content=null,w.remove(),w=null,v.on("disposed")(),y=!1)},this.reload(),v.on("init")()}Window.count=0,Window.DISPOSE_ON_CLOSE=0,Window.HIDE_ON_CLOSE=1,Window.DO_NOTHING_ON_CLOSE=2,Window.DOUBLE_CLICK_DELAY=300;const WindowState={NORMAL:0,MAXIMIZED:1,MINIMIZED:2,SHOWN:3,HIDDEN:4},WindowUtil={getProperty:function(a,b,c){return"undefined"==typeof a[b]?c:a[b]}};